
/* -------------------------------------------------- *
 _____  _          _____   _                          *
|  __ \(_)        |  __ \ | |                         *
| |__) |_  ______ | |__) || |__    ___   _ __    ___  *
|  ___/| ||______||  ___/ | '_ \  / _ \ | '_ \  / _ \ *
| |    | |        | |     | | | || (_) || | | ||  __/ *
|_|    |_|        |_|     |_| |_| \___/ |_| |_| \___| *
----------------------------------------------------- *                                                     
* Project:        Pi-Phone                            *
* Team:           Alexander Hausmann & Ilka Salomon   *
* Creation date:  07.05.2018                          *
* Current state:  07.05.2018                          *
----------------------------------------------------- */

// INCLUDES
#include <wiringPi.h>       // Source: https://github.com/WiringPi/WiringPi/blob/master/wiringPi/wiringPi.h
#include <wiringSerial.h>   // Source: https://github.com/WiringPi/WiringPi/blob/master/wiringPi/wiringSerial.h
#include <string.h>
// --

// DEFINES
// -> General
  #define LOOP while(1)
  #define BAUDRATE 9600
// -> GSM-Modem
  //     Name    Pin-Number
  #define NET       
  #define RST       
  #define RXT       
  #define TXD       
  #define RING      
  #define DTR       
  #define MICP      
  #define MICN      
  #define SPKP      
  #define SPKN      
// --

// FUNCTION PROTOTYPES
// --

// MAIN PROGRAM ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
void main () {

  // VARIABLES
  // -> For Serial Functions
    int fd; 
    char answer[20];
    char message[100];
    char number[14];
    char tdstring[120];
  
  // -- End Variables
  
  // SETUP
  // -> Pins                      
    pinMode (NET, INPUT);   // Network State ??
    pinMode (RST, OUTPUT);  // Reset ??
    pinMode (RXT, INPUT);   // Recieve Data
    pinMode (TXD, OUTPUT);  // Transmit Data
    pinMode (RING, INPUT);  // Ring ??
    pinMode (DTR, INPUT);   // Data Terminal Ready
    pinMode (MICP, INPUT);  // '\ Differential Audio 
    pinMode (MICN, INPUT);  // ,/ Input
    pinMode (SPKP, OUTPUT); // '\ Differential Audio
    pinMode (SPKN, OUTPUT); // ,/ Output
  // -> Serial
                      // USB !!!!
    fd = serialOpen ("/dev/ttyAMA0", BAUDRATE); // Start Serial Communication
    wiringPiSetup ();                           // Wiring Pi Setup
  // -- End Setup
  
  // FOREVER-LOOP
  LOOP {
    // SMS ---
    
    message = strcpy(message, "Hello World");  // TE
    number = strcpy(number, "+491781982364");  // ST
    
    serialPuts(fd, "AT+CMGF=1");                                 // Sets the GSM-Modem in SMS Text Mode 
    answer = serialGetchar(fd);                                  // Get answer of GSM-Modem
    if (answer == "OK") {                                        // Answer is "OK"?
     strcpy (tdstring, "AT+CMGS=\"");                            // Make tdString -> Start String
     strcat (tdsting", number);                                  // .. -> Number of Receiver
     strcat (tdstring, \">);                                     // .. -> String after Number
     strcat (tdstring, message);                                 // .. -> Message to Receiver
     strcat (tdstring, ><CTRL-Z>");                              // .. -> End String
     serialPuts(fd, tdstring);                                   // Sends Message
    }
    // -- End Sms
    
  }
  // -- End Loop
}
// -- End Main
